<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProjectAccs ‚Äî –ü—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç—ã —Å –æ–ø–ª–∞—Ç–æ–π –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π</title>
    <meta
      name="description"
      content="–ü–æ–∫—É–ø–∞–π—Ç–µ –ø—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è Postogram, TikTok –∏ Snapchat. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π. –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram."
    />
    <meta name="author" content="ProjectAccs" />
    <meta
      name="keywords"
      content="–∞–∫–∫–∞—É–Ω—Ç—ã, –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞, –ø–æ–∫—É–ø–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤, Postogram, TikTok, Snapchat, Telegram"
    />

    <meta
      property="og:title"
      content="ProjectAccs ‚Äî –ü—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç—ã —Å –æ–ø–ª–∞—Ç–æ–π –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π"
    />
    <meta
      property="og:description"
      content="–ü–æ–∫—É–ø–∞–π—Ç–µ –ø—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π —á–µ—Ä–µ–∑ Telegram."
    />
    <meta property="og:type" content="website" />

    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <header class="header">
      <div class="container header-inner">
        <div class="logo-wrap">
          <div class="logo-icon">
            <i class="lucide-wallet"></i>
          </div>
          <h1 class="logo-text">ProjectAccs</h1>
        </div>
        <div class="header-actions">
          <button class="cart-btn" id="cartBtn">
            <i class="lucide-shopping-cart"></i>
            <span style="margin-left:6px; font-weight:600">–ö–æ—Ä–∑–∏–Ω–∞</span>
            <span class="cart-count" id="cartCount">0</span>
          </button>
          <button class="profile-btn" id="profileBtn">
            <i class="lucide-user"></i>
          </button>
        </div>
      </div>
    </header>

    <section class="hero">
      <div class="hero-overlay"></div>
      <div class="container hero-content">
        <span class="badge">
          <i class="lucide-zap"></i> –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ ‚Ä¢ –û–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π
        </span>
        <h2 class="hero-title">
          –ü—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç—ã
          <span>—Å –æ–ø–ª–∞—Ç–æ–π –≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–µ</span>
        </h2>
        <p class="hero-subtitle">
          –ü–æ–∫—É–ø–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è Postogram, TikTok –∏ Snapchat.
          –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑
          Telegram.
        </p>
        <div class="hero-buttons">
          <button class="btn-gradient large">
            <i class="lucide-message-circle"></i> –ù–∞—á–∞—Ç—å –≤ Telegram
          </button>
          <button class="btn-outline large">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–∞–ª–æ–≥</button>
        </div>
      </div>
    </section>

    <section class="categories">
      <div class="container">
        <h3 class="section-title">–ö–∞—Ç–∞–ª–æ–≥ –∞–∫–∫–∞—É–Ω—Ç–æ–≤</h3>
        <p class="section-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∏ —Ä–µ–≥–∏–æ–Ω</p>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filters">
          <div class="filter-group">
            <label class="filter-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</label>
            <div class="filter-buttons">
              <button class="filter-btn active" data-platform="all">–í—Å–µ</button>
              <button class="filter-btn" data-platform="postogram">
                <i class="lucide-instagram"></i> Postogram
              </button>
              <button class="filter-btn" data-platform="tiktok">
                <i class="lucide-message-circle"></i> TikTok
              </button>
              <button class="filter-btn" data-platform="snapchat">
                <i class="lucide-camera"></i> Snapchat
              </button>
            </div>
          </div>
          <div class="filter-group">
            <label class="filter-label">–†–µ–≥–∏–æ–Ω:</label>
            <div class="filter-buttons">
              <button class="filter-btn active" data-region="all">–í—Å–µ</button>
              <button class="filter-btn" data-region="USA">USA</button>
              <button class="filter-btn" data-region="Europe">Europe</button>
            </div>
          </div>
          <div class="filter-group">
            <label class="filter-label">–ü—Ä–æ–≥—Ä–µ–≤:</label>
            <div class="filter-buttons">
              <button class="filter-btn active" data-warmup="all">–í—Å–µ</button>
              <button class="filter-btn" data-warmup="30 –î–Ω–µ–π –û—Ç–ª—ë–∂–∫–∏">30 –î–Ω–µ–π –û—Ç–ª—ë–∂–∫–∏</button>
              <button class="filter-btn" data-warmup="3 –î–Ω—è –ü—Ä–æ–≥—Ä–µ–≤–∞">3 –î–Ω—è –ü—Ä–æ–≥—Ä–µ–≤–∞</button>
              <button class="filter-btn" data-warmup="7 –î–Ω–µ–π –ü—Ä–æ–≥—Ä–µ–≤–∞">7 –î–Ω–µ–π –ü—Ä–æ–≥—Ä–µ–≤–∞</button>
            </div>
          </div>
        </div>

        <!-- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class="catalog-grid" id="catalogGrid">
          <div class="loading-state">
            <i class="lucide-loader"></i>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞...</p>
          </div>
        </div>

        <!-- Loading overlay –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–µ—Ä—Ü–∞–Ω–∏—è -->
        <div class="catalog-loading-overlay" id="catalogLoadingOverlay" style="display: none;">
          <div class="loading-overlay-content">
            <i class="lucide-loader"></i>
            <p>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞...</p>
          </div>
        </div>
      </div>
    </section>

    <section class="features">
      <div class="container">
        <h3 class="section-title">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç ProjectAccs</h3>
        <p class="section-subtitle">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å</p>

        <div class="grid features-grid">
          <div class="card small">
            <div class="icon small"><i class="lucide-lock"></i></div>
            <h4>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞</h4>
            <p>–í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –∫—Ä–∏–ø—Ç–æ–±–æ—Ç–∞ —Å –∑–∞—â–∏—Ç–æ–π –¥–∞–Ω–Ω—ã—Ö</p>
          </div>
          <div class="card small">
            <div class="icon small"><i class="lucide-zap"></i></div>
            <h4>–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</h4>
            <p>–ü–æ–ª—É—á–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã</p>
          </div>
          <div class="card small">
            <div class="icon small"><i class="lucide-shield"></i></div>
            <h4>–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞</h4>
            <p>–ö–∞–∂–¥—ã–π –∞–∫–∫–∞—É–Ω—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –ø—Ä–æ–∫—Å–∏</p>
          </div>
          <div class="card small">
            <div class="icon small"><i class="lucide-clock"></i></div>
            <h4>–î–æ—Å—Ç—É–ø 24/7</h4>
            <p>
              –ü–æ–∫—É–ø–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è —Å –ø–æ–º–æ—â—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π
              —Å–∏—Å—Ç–µ–º—ã
            </p>
          </div>
        </div>
      </div>
    </section>

    <section class="cta">
      <div class="container">
        <div class="cta-card">
          <h3>–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?</h3>
          <p>
            –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Ç—ã—Å—è—á–∞–º –¥–æ–≤–æ–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É
            Telegram-–±–æ—Ç—É –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø–æ–∫—É–ø–∫—É –ø—Ä–µ–º–∏—É–º-–∞–∫–∫–∞—É–Ω—Ç–æ–≤ —É–∂–µ —Å–µ–≥–æ–¥–Ω—è.
          </p>
          <button class="btn-gradient large">
            <i class="lucide-message-circle"></i> –û—Ç–∫—Ä—ã—Ç—å Telegram-–±–æ—Ç–∞
          </button>
        </div>
      </div>
    </section>

    <section class="profile-page" id="profilePage" style="display: none">
      <div class="container">
        <div class="profile-header">
          <button class="back-btn" id="backBtn">
            <i class="lucide-arrow-left"></i> –ù–∞–∑–∞–¥
          </button>
          <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
        </div>

        <div class="profile-content">
          <div class="profile-card">
            <div class="profile-avatar">
              <i class="lucide-user"></i>
            </div>
            <h3 id="userUsername">@username</h3>
            <p class="muted-text">
              Telegram ID: <span id="userTelegramId">‚Äî</span>
            </p>
          </div>

          <div class="profile-section">
            <h3><i class="lucide-clock"></i> –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
            <div class="activity-list" id="activityList">
              <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏...</p>
            </div>
          </div>

          <div class="profile-section">
            <h3><i class="lucide-shopping-bag"></i> –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
            <p class="sync-note">
              <i class="lucide-refresh-cw"></i> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º
              –≤—Ä–µ–º–µ–Ω–∏
            </p>
            <div class="orders-list" id="ordersList">
              <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã - –ó–ê–ú–ï–ù–ï–ù–û –ù–ê –°–ï–ö–¶–ò–Æ -->
    <!-- –°–µ–∫—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã (–∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω) -->
    <section class="cart-page" id="cartPage" style="display: none;">
      <div class="container">
        <div class="cart-header">
          <button class="back-btn" id="cartBackBtn">
            <i class="lucide-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É
          </button>
          <h2><i class="lucide-shopping-cart"></i> –ö–æ—Ä–∑–∏–Ω–∞</h2>
        </div>

        <div class="cart-content" id="cartPageBody">
          <div class="empty-cart">
            <i class="lucide-shopping-cart"></i>
            <p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
            <button class="btn-outline" id="emptyCartBackBtn">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</button>
          </div>
        </div>

        <div class="cart-page-footer" id="cartPageFooter" style="display: none;">
          <div class="cart-summary">
            <div class="cart-summary-row">
              <span>–¢–æ–≤–∞—Ä–æ–≤:</span>
              <span id="cartItemsCount">0</span>
            </div>
            <div class="cart-summary-row total">
              <span>–ò—Ç–æ–≥–æ:</span>
              <span class="cart-total-amount" id="cartTotalAmount">0 USDT</span>
            </div>
          </div>
          <div class="cart-actions">
            <button class="btn-outline" id="clearCartBtn">
              <i class="lucide-trash-2"></i> –û—á–∏—Å—Ç–∏—Ç—å
            </button>
            <button class="btn-gradient large" id="checkoutBtn">
              <i class="lucide-credit-card"></i> –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
          </div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <p>
        ¬© 2025 ProjectAccs. –í—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã –ø–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –ø—Ä–æ–∫—Å–∏.
      </p>
      <p class="small">–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π —á–µ—Ä–µ–∑ Crypto Bot</p>
    </footer>

    <script src="auth.js"></script>
    <script src="cart.js?v=27"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫ Lucide
      lucide.createIcons();
    </script>

    <script>
      const profileBtn = document.getElementById("profileBtn");
      const backBtn = document.getElementById("backBtn");
      const profilePage = document.getElementById("profilePage");
      const mainContent = document.querySelectorAll(
        ".hero, .categories, .features, .cta"
      );

      profileBtn.addEventListener("click", () => {
        mainContent.forEach((el) => (el.style.display = "none"));
        profilePage.style.display = "block";
        window.scrollTo(0, 0);
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        if (window.authManager && window.authManager.currentUser) {
          window.authManager.loadUserData();
        }
      });

      backBtn.addEventListener("click", () => {
        profilePage.style.display = "none";
        mainContent.forEach((el) => (el.style.display = "block"));
        window.scrollTo(0, 0);
      });

      // –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
      const catalogGrid = document.getElementById("catalogGrid");
      let currentFilters = {
        platform: "all",
        region: "all",
        warmup: "all"
      };

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
      document.querySelectorAll('.filter-btn[data-platform]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn[data-platform]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentFilters.platform = btn.dataset.platform;
          applyFilters();
        });
      });

      document.querySelectorAll('.filter-btn[data-region]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn[data-region]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentFilters.region = btn.dataset.region;
          applyFilters();
        });
      });

      document.querySelectorAll('.filter-btn[data-warmup]').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn[data-warmup]').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentFilters.warmup = btn.dataset.warmup;
          applyFilters();
        });
      });

      // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è loading overlay –∫–∞—Ç–∞–ª–æ–≥–∞
      function showCatalogLoading() {
        const overlay = document.getElementById('catalogLoadingOverlay');
        if (overlay) {
          overlay.style.display = 'flex';
        }
      }

      function hideCatalogLoading() {
        const overlay = document.getElementById('catalogLoadingOverlay');
        if (overlay) {
          overlay.style.display = 'none';
        }
      }

      // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞
      async function loadCatalog() {
        console.log('%c[loadCatalog] ‚ïê‚ïê‚ïê START ‚ïê‚ïê‚ïê', 'color: cyan; font-size: 16px; font-weight: bold');
        console.log('[loadCatalog] Called at:', new Date().toISOString());
        console.log('[loadCatalog] Stack trace:', new Error().stack);

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º loading overlay –ø–æ–≤–µ—Ä—Ö –∫–∞—Ç–∞–ª–æ–≥–∞
        showCatalogLoading();

        // –ù–ï –æ—á–∏—â–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ —Å—Ä–∞–∑—É, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º–µ—Ä—Ü–∞–Ω–∏—è
        // catalogGrid.innerHTML = '<div class="loading-state"><i class="lucide-loader"></i><p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞...</p></div>';

        try {
          // –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ ISO —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å reserved_until
          const nowISO = new Date().toISOString();
          console.log('[loadCatalog] Current time (ISO):', nowISO);

          // –ó–∞–≥—Ä—É–∂–∞–µ–º products –∏ accounts –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
          // –§–∏–ª—å—Ç—Ä –¥–ª—è accounts: –ù–ï –ø—Ä–æ–¥–∞–Ω –ò –ù–ï –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω (–ø—Ä–æ–≤–µ—Ä–∫–∞ reservation_id="")
          // PocketBase —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ sold=false && reservation_id=""
          // –ö–ª–∏–µ–Ω—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç reserved_until
          const perPage = 500;
          const accountsFilter = encodeURIComponent(`sold=false && reservation_id=""`);
          // Add cache-busting timestamp to force fresh data
          const cacheBuster = `&_t=${Date.now()}`;

          console.log('[loadCatalog] Accounts filter:', accountsFilter);
          console.log('[loadCatalog] Decoded filter:', `sold=false && reservation_id=""`);

          console.log('[loadCatalog] Fetching products and accounts...');

          const [productsResponse, accountsResponse] = await Promise.all([
            fetch(`http://127.0.0.1:8090/api/collections/products/records?expand=category&sort=title&perPage=${perPage}${cacheBuster}`, {
              method: 'GET',
              headers: {
                'Cache-Control': 'no-cache, no-store, must-revalidate',
                'Pragma': 'no-cache',
                'Expires': '0'
              }
            }),
            fetch(`http://127.0.0.1:8090/api/collections/accounts/records?filter=${accountsFilter}&perPage=${perPage}${cacheBuster}`, {
              method: 'GET',
              headers: {
                'Cache-Control': 'no-cache, no-store, must-revalidate',
                'Pragma': 'no-cache',
                'Expires': '0'
              }
            })
          ]);

          console.log('[loadCatalog] Products response status:', productsResponse.status);
          console.log('[loadCatalog] Accounts response status:', accountsResponse.status);

          if (!productsResponse.ok || !accountsResponse.ok) {
            throw new Error('Failed to load catalog');
          }

          const productsData = await productsResponse.json();
          const accountsData = await accountsResponse.json();

          console.log('%c[loadCatalog] Data received from API:', 'color: lime; font-weight: bold', {
            productsCount: productsData.items.length,
            accountsCountRaw: accountsData.items.length
          });

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–∫–∫–∞—É–Ω—Ç—ã –≥–ª–æ–±–∞–ª—å–Ω–æ (—Ç–æ–ª—å–∫–æ –î–û–°–¢–£–ü–ù–´–ï ‚Äî –Ω–µ –ø—Ä–æ–¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
          // –í–ê–ñ–ù–û: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, —Ç.–∫. PocketBase —Ç–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ reservation_id=""
          const now = new Date();

          console.log('%c[loadCatalog] ‚ïê‚ïê‚ïê CLIENT-SIDE FILTERING ‚ïê‚ïê‚ïê', 'color: yellow; font-size: 14px; font-weight: bold');
          console.log('[loadCatalog] Raw accounts from API:', accountsData.items.length);
          console.log('[loadCatalog] Sample raw accounts (first 3):', accountsData.items.slice(0, 3).map(acc => ({
            id: acc.id,
            product: acc.product,
            sold: acc.sold,
            reservation_id: acc.reservation_id || 'EMPTY',
            reserved_until: acc.reserved_until || 'EMPTY'
          })));

          window.allAccounts = accountsData.items.filter(acc => {
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–¥–∞–Ω–Ω—ã–µ
            if (acc.sold) {
              console.log(`[loadCatalog] FILTERED OUT (sold): ${acc.id}`);
              return false;
            }

            // PocketBase —É–∂–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª –ø–æ reservation_id="", –Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º reserved_until
            // –ï—Å–ª–∏ –µ—Å—Ç—å reserved_until - –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ç—ë–∫ –ª–∏ —Ä–µ–∑–µ—Ä–≤
            if (acc.reserved_until) {
              try {
                // PocketBase –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ "YYYY-MM-DD HH:MM:SS.sssZ"
                const reservedUntil = new Date(acc.reserved_until);
                const isExpired = reservedUntil < now;
                if (!isExpired) {
                  console.log(`[loadCatalog] FILTERED OUT (reserved until ${acc.reserved_until}): ${acc.id}`);
                }
                // –ï—Å–ª–∏ reserved_until –≤ –ø—Ä–æ—à–ª–æ–º - –∞–∫–∫–∞—É–Ω—Ç —Å–≤–æ–±–æ–¥–µ–Ω
                return isExpired;
              } catch (e) {
                console.warn('Failed to parse reserved_until:', acc.reserved_until, e);
                return false; // –ï—Å–ª–∏ –Ω–µ —Å–º–æ–≥–ª–∏ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å - —Å—á–∏—Ç–∞–µ–º –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
              }
            }

            // –ê–∫–∫–∞—É–Ω—Ç —Å–≤–æ–±–æ–¥–µ–Ω
            return true;
          }) || [];

          console.log('%c[loadCatalog] AFTER CLIENT FILTER:', 'color: lime; font-weight: bold');
          console.log('[loadCatalog] Available accounts:', window.allAccounts.length);
          console.log('[loadCatalog] Filtered out:', accountsData.items.length - window.allAccounts.length, 'accounts');

          // –í—ã–≤–µ–¥–µ–º –ø–µ—Ä–≤—ã–µ 5 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
          if (window.allAccounts.length > 0) {
            console.log('[loadCatalog] Sample accounts (first 5):', window.allAccounts.slice(0, 5).map(acc => ({
              id: acc.id,
              product: acc.product,
              sold: acc.sold,
              reservation_id: acc.reservation_id,
              reserved_until: acc.reserved_until
            })));

            // –ù–∞–π–¥—ë–º –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞ wx920gv91bjc7fi
            const testProductAccounts = window.allAccounts.filter(acc =>
              acc.product === 'wx920gv91bjc7fi' || (acc.product && acc.product.id === 'wx920gv91bjc7fi')
            );
            console.log(`[loadCatalog] üîç Accounts for wx920gv91bjc7fi: ${testProductAccounts.length} found`);
            if (testProductAccounts.length > 0) {
              console.log('[loadCatalog] First 10 wx920gv91bjc7fi accounts:', testProductAccounts.slice(0, 10).map(acc => ({
                id: acc.id,
                reservation_id: acc.reservation_id || 'EMPTY',
                reserved_until: acc.reserved_until || 'EMPTY'
              })));
            }
          }

          // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –î–û–°–¢–£–ü–ù–´–• –∞–∫–∫–∞—É–Ω—Ç–æ–≤
          console.log('%c[loadCatalog] ‚ïê‚ïê‚ïê COUNTING PRODUCTS ‚ïê‚ïê‚ïê', 'color: cyan; font-size: 14px; font-weight: bold');

          window.allProducts = productsData.items.map(product => {
            const count = window.allAccounts.filter(acc => {
                // account.product can be stored as a string (id or key),
                // or as an expanded object with id (and maybe key)
                const accProd = acc.product;
                const prodId = product.id;
                const prodKey = (product.key || product.sku || '').toString();

                // if acc.product is a string - it may be product.id or product.key
                if (typeof accProd === 'string') {
                  return accProd === prodId || (prodKey && accProd === prodKey);
                }

                // if acc.product is an object (expanded) - check id and key
                if (accProd && typeof accProd === 'object') {
                  if (accProd.id && accProd.id === prodId) return true;
                  if (accProd.key && prodKey && accProd.key === prodKey) return true;
                }

                return false;
              }).length;

            console.log(`[loadCatalog] Product "${product.product_name || product.title}" (${product.id}): ${count} available accounts`);

            return {
              ...product,
              quantity: count
            };
          });

          console.log('%c[loadCatalog] ‚ïê‚ïê‚ïê FINAL PRODUCTS ‚ïê‚ïê‚ïê', 'color: lime; font-size: 14px; font-weight: bold');
          console.log('[loadCatalog] Total products:', window.allProducts.length);
          console.log('[loadCatalog] Products with stock:', window.allProducts.filter(p => p.quantity > 0).length);
          console.log('[loadCatalog] Products summary:', window.allProducts.map(p => ({
            name: p.product_name || p.title,
            id: p.id,
            qty: p.quantity
          })));

          console.log('[loadCatalog] Calling renderCatalog()...');
          renderCatalog(window.allProducts);
          console.log('%c[loadCatalog] ‚ïê‚ïê‚ïê COMPLETED ‚ïê‚ïê‚ïê', 'color: cyan; font-size: 16px; font-weight: bold');

        } catch (error) {
          console.error('%c[loadCatalog] ‚úó FATAL ERROR', 'color: red; font-size: 16px; font-weight: bold', error);
          catalogGrid.innerHTML = '<div class="error-state"><i class="lucide-alert-circle"></i><p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞</p></div>';
        } finally {
          // –°–∫—Ä—ã–≤–∞–µ–º loading overlay –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
          hideCatalogLoading();
        }
      }

      // –î–µ–ª–∞–µ–º loadCatalog –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è cart.js
      console.log('%c[index.html] Assigning window.reloadCatalog', 'color: orange; font-weight: bold');
      window.reloadCatalog = loadCatalog;
      console.log('[index.html] window.reloadCatalog assigned, type:', typeof window.reloadCatalog);

      // –ü–∞—Ä—Å–∏–Ω–≥ –∫–ª—é—á–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ä–µ–≥–∏–æ–Ω–∞ –∏ –ø—Ä–æ–≥—Ä–µ–≤–∞
      function parseProductKey(productKey) {
        if (!productKey) return { platform: null, warmup: null, region: null };

        const key = productKey.toLowerCase();

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É
        let platform = null;
        if (key.startsWith('ig')) platform = 'postogram';
        else if (key.startsWith('snap')) platform = 'snapchat';
        else if (key.startsWith('tt')) platform = 'tiktok';

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ–≤
        let warmup = null;
        if (key.includes('_0')) warmup = '30 –î–Ω–µ–π –û—Ç–ª—ë–∂–∫–∏';
        else if (key.includes('_3')) warmup = '3 –î–Ω—è –ü—Ä–æ–≥—Ä–µ–≤–∞';
        else if (key.includes('_7')) warmup = '7 –î–Ω–µ–π –ü—Ä–æ–≥—Ä–µ–≤–∞';

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–≥–∏–æ–Ω
        let region = null;
        if (key.includes('_us')) region = 'USA';
        else if (key.includes('_eur')) region = 'Europe';

        return { platform, warmup, region };
      }

      // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
      function applyFilters() {
        if (!window.allProducts) return;

        let filtered = window.allProducts;

        // –§–∏–ª—å—Ç—Ä –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ (–ø–∞—Ä—Å–∏–º –∫–ª—é—á: –ø—Ä–æ–±—É–µ–º product.key -> product.sku -> product.id)
        if (currentFilters.platform !== 'all') {
          filtered = filtered.filter(product => {
            const parsed = parseProductKey(product.key || product.sku || product.id);
            return parsed.platform === currentFilters.platform;
          });
        }

        // –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–≥–∏–æ–Ω—É (–ø–∞—Ä—Å–∏–º –∫–ª—é—á)
        if (currentFilters.region !== 'all') {
          filtered = filtered.filter(product => {
            const parsed = parseProductKey(product.key || product.sku || product.id);
            return parsed.region === currentFilters.region;
          });
        }

        // –§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–æ–≥—Ä–µ–≤—É (–ø–∞—Ä—Å–∏–º –∫–ª—é—á)
        if (currentFilters.warmup !== 'all') {
          filtered = filtered.filter(product => {
            const parsed = parseProductKey(product.key || product.sku || product.id);
            return parsed.warmup === currentFilters.warmup;
          });
        }

        console.log('Filtered products:', filtered.length, 'of', window.allProducts.length);
        console.log('Current filters:', currentFilters);
        renderCatalog(filtered);
      }

      // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
      function renderCatalog(products) {
        if (products.length === 0) {
          catalogGrid.innerHTML = '<div class="empty-state"><i class="lucide-package"></i><p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p></div>';
          return;
        }

        const platformIcons = {
          'postogram': 'instagram',
          'tiktok': 'message-circle',
          'snapchat': 'camera'
        };

        const platformColors = {
          'postogram': 'purple',
          'tiktok': 'cyan',
          'snapchat': 'yellow'
        };

        catalogGrid.innerHTML = products.map(product => {
          // –ü–∞—Ä—Å–∏–º –∫–ª—é—á –ø—Ä–æ–¥—É–∫—Ç–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, —Ä–µ–≥–∏–æ–Ω–∞ –∏ –ø—Ä–æ–≥—Ä–µ–≤–∞
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–Ω–∞—á–∞–ª–∞ product.key (sku), –∑–∞—Ç–µ–º product.sku, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º product.id
          const parsed = parseProductKey(product.key || product.sku || product.id);
          const platformSlug = parsed.platform || 'postogram';
          const regionForFilter = parsed.region || 'USA';
          const typeOfWarm = parsed.warmup || '';

          return `
            <div class="product-card" data-product-id="${product.id}" data-platform="${platformSlug}" data-region="${regionForFilter.toLowerCase()}">
              <div class="product-header">
                <div class="icon ${platformColors[platformSlug] || 'purple'}">
                  <i class="lucide-${platformIcons[platformSlug] || 'instagram'}"></i>
                </div>
                <span class="region-badge">${regionForFilter}</span>
              </div>
              <h4>${product.title || '–¢–æ–≤–∞—Ä'}</h4>
              ${typeOfWarm ? `<div class="warmup-badge">${typeOfWarm}</div>` : ''}
              <p class="product-description">${product.description || '–ü—Ä–µ–º–∏—É–º –∞–∫–∫–∞—É–Ω—Ç —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π'}</p>
              <div class="product-footer">
                <div class="product-price">
                  <span class="price-amount">${product.price || '0'}</span>
                  <span class="price-currency">USDT</span>
                </div>
                <span class="stock-badge ${product.quantity > 0 ? 'in-stock' : 'out-of-stock'}" data-stock-badge="${product.id}">
                  ${product.quantity > 0 ? `${product.quantity} —à—Ç.` : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                </span>
              </div>
              <div class="product-controls">
                <div class="quantity-selector">
                  <button class="qty-btn product-decrease" data-product-id="${product.id}" ${product.quantity === 0 ? 'disabled' : ''}>-</button>
                  <input class="qty-input product-qty-input" type="number" min="1" max="${product.quantity}" value="1" data-product-id="${product.id}" ${product.quantity === 0 ? 'disabled' : ''} />
                  <button class="qty-btn product-increase" data-product-id="${product.id}" ${product.quantity === 0 ? 'disabled' : ''}>+</button>
                </div>

                <button class="btn-product add-to-cart" data-product-id="${product.id}" data-product-title="${product.title}" data-product-price="${product.price}" data-type-of-warm="${product.type_of_warm || ''}" data-region-for-filter="${product.region_for_filter || ''}" ${product.quantity === 0 ? 'disabled' : ''}>
                  <i class="lucide-plus"></i> –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
              </div>
            </div>
          `;
        }).join('');

        // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º –∏–∫–æ–Ω–∫–∏ Lucide –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞
        if (typeof lucide !== 'undefined') {
          lucide.createIcons();
        }
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.addEventListener('DOMContentLoaded', () => {
        loadCatalog();
      });
    </script>
  </body>
</html>
